# Ryu-Traffic-Schedule-System

# Ryu-Traffic-Schedule-System
```For a better reading experience, please use https://dillinger.io/ to read```<https://dillinger.io/>

## Overview
Ryu-Traffic-Schedule-System is a traffic scheduling system based on Ryu controller. It has functions such as Topo discovery, link traffic statistics, Custom traffic statistics, current traffic scheduling, and empirical value intelligent scheduling, and supports GrafanaGUI real-time display.

## Architecture
![flow chart](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/Ryu-Schedule%20(1).iodraw%20(2).png?raw=true)

***Architectural components***
| Components | Description |
| ------ | ------ |
| Ryu-Manager | Ryu Controller |
| App1 Topo_feel | Used for switch Topo discovery |
| App2 Get_link_speed | Used to calculate the rate of SWitch Link, such as the total traffic rate between Switch2->Switch3 |
| App3 Get_Path | Add optimal forwarding flow table for new custom |
| App4 Monitor_flow_stats | Used to calculate the service rate, such as the service flow rate between h1->h10 |
| App5 Schedule_traffic | Core scheduling APP |
| DB:Switch Link SpeedDB | Stores the speed of the switch link corresponding to Get_link_speed, sqlite3DB |
| DB:Custom SpeedDB | Store the custom rate corresponding to Monitor_flow_stats, sqlite3DB |
| Grafana | Read Switch Link SpeedDB and Custom SpeedDB, generate GUI |
| Topo | Switch topo, generated by Ryu |

***Architectural Principle***
![Arch1](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/ar2.png?raw=true)

***Detailed process***
1.After starting Ryu-App, Ryu Manager will first read the information in Setting.py
```
ryu/app# cat setting.py
Monitor_period = 20    # unit second, For monitoring flow traffic and link traffic interval, default 20,It is recommended to set more than 15 seconds
Link_Threshold = 100000000   # unit bit/s, Link rate threshold，100000000 means:100Mbps
Time_mode = "hours" 
#hours: Refer to the previous hour rate
#days: Refer to the rate at the same time of the previous day
#weeks: Refer to the rate at the same time in the previous week
###Time_mode：
After the reference flow and the current flow are merged, if the Link threshold is exceeded, the scheduling is performed
For example:
The public link Switch3->Switch4 currently contains the traffic of custom host5->host10 (30Mbps) and the traffic of host6->host8 (50Mbps); when the time reaches the hour, calculate the rate of reference traffic host5->host10 (60Mbps), 50Mbps +60Mbps>100Mbps (exceeding the link threshold); App performs traffic scheduling and switches host6->host8 traffic to other links in advance.
Scheduling example:
For example, Time_mode=days, 2021-8-11, 16:00-17:00 reference traffic host5->host10 rate is 60Mbps; 2021-08-12, 16:00 scheduling, if host5-host10 traffic is less than the reference traffic, The rate of host5->host10 is assumed to be a reference traffic of 60Mbps for scheduling calculation.
Reference flow calculation method:
From August 11, 2021, 16:00-17:00, monitor_period records the traffic rate of host5->host10 every interval, and uses the 95 algorithm to eliminate traffic bursts and obtain the reference rate.
95 algorithm:
For example, from 16:00 to 17:00, 180 rate points are obtained, sorted from small to large, and the 171st (180*0.95) is taken as the reference rate.
```

2.Ryu-manager runs all apps
3.App1 Topo_feel obtains Topo through packet-out/packet-in LLDP and generates Topo
```
Topo_feel
This function is used for periodic Topo discovery and for initial communication
between hosts (relying on the controller packet-in/packet-out to complete the initial communication)
Implementation:
1. Get the connection between switches through add lldp flow table, action controller
2. Get host information through add ip/arp flow table, action controller
3. Realize the first communication between hosts through packet-in/packet-out
```
4.App2 Get_Link_speed calculates the rate of Link between each Switch through each interval Monitor_period
```
Get_Link_speed
This function is used for Obtain the rate of each port periodically;
Calculation method:
At time a, the statistics of all switches and all interfaces are obtained through port_stats_request message
At time a+interval, obtain statistics of all switches and all interfaces through port_stats_request message
Get the rate through (stats(a+interval)-stats(a)/interval)

At the same time, this function will store the link rate in sqlite3 DB, and users can perform visual operations in grafana.
DB Format: nowtime,link(srcswitchid_dstswitchid),link_rate_tx
```
5.Save the data in step 4 into Switch Link SpeedDB
6.App3 Get_path monitors new host access, refer to the rate of Switch Link in `Step7`SwitchLinkDB, and add the optimal flow table
```
Get_path
This function can select the optimal path for the newly connected host and add flow
Selection strategy:
1. If the host that needs to communicate belongs to the same switch, add flow directly
2. If the host that needs to communicate does not belong to the same switch
  2.1 The shortest path is selected by default (all link rates of the shortest path should be less than link-rate-threshold*90%)
  2.2 If any segment of the shortest path exceeds the link rate threshold *90%, select the shortest path among other available links
  2.3 If all links exceed the link rate threshold *90%, the administrator is reminded to add newphysical lines.
```
7.Contained in `6`
8.Contained in `6`
9.APP4 Monitor Flow Stats calculates the Custom rate between each group of hosts in every interval Monitor_period
```
Monitor Flow Stats
This function is used for calculating the rate between host services, such as calculating the rate of services between h1 and h10.
Calculation method:
At time a, the statistics of all switches and all flows are obtained through port_stats_request message
At time a+interval, obtain statistics of all switches and all flows through port_stats_request message
Get the rate through (stats(a+interval)-stats(a)/interval)    

At the same time, the business rate will be stored in the sqlite3 DB, and the log will be printed.
DB format: time,src_dst(such as 10.0.0.1_10.0.0.10),path(The nodes that h1 and h10 communicate through,such as h1-s1-s2-s5-h10),Speed
```
10.Store the Custom rate in step 9 into CustomSpeedDB
11.App5 Schedule_Traffic passed, CustomSpeedDB and SwitchLinkDB for current traffic scheduling, hourly historical experience value traffic scheduling
```
This function is the core of scheduling,
It mainly contains two scheduling functions:
1.check_currect_bw: Check the rate of all link of switches, if it exceeds the link rate threshold, turn on the scheduling function. The scheduling function logic is as follows:
 1.1 Determine whether there is a link that exceeds the link rate threshold in the topo. If no link exceeds the threshold, no scheduling is performed
 1.2 If a link exceeds the threshold, query the rate of all customer services (such as h1 to h5...) passing through this link, and move some services 
 (to ensure that the current link rate after moving is less than the threshold) to other idle links .

2.check_feature_bw: Execute once an hour, and estimate the rate in the next hour based on the custom rate at the same time yesterday or last week. 
The scheduling logic is as follows:
 2.1. Extract the current rate of all services (such as h5 to h10 60M; h6 to h8 20M); extract the reference rate of yesterday or last week in the database (95% algorithm, 
 so that traffic bursts can be excluded) (such as h5 to h10 50M, h6 to h8 70M); merge the current rate and the reference rate, 
 and guess the rate in the next hour (such as h5 to h10 60M, h6 to h8 70M), so the link (switch4-switch5) rate in the next hour is 130Mbps, 
 Exceed the threshold of 100M, switch h6->h8 to other links
```
12.Grafana will extract the data in CustomSpeedDB and SwitchLinkSpeedDB in real time and present it as a GUI.

## Installation Guide
***Environmental requirements***
-[x] Ubuntu Or CentecOS (demo environment is ubuntu20.04)
-[x] CPU with at least 4 cores
-[x] RAM at least 8G

***installation steps***
```
apt update
apt install git -y
pip install ryu
```
`Mininet`: 
```
git clone git://github.com/mininet/mininet; mininet/util/install.sh -a
```
`Ryu`: 
```
git clone git://github.com/osrg/ryu.git; cd ryu; pip install
```

`Grafana`
```
apt-get install -y apt-transport-https
apt-get install -y software-properties-common wget
echo "deb https://packages.grafana.com/oss/deb stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list
apt update
apt-get install grafana
sudo systemctl start grafana-server
sudo systemctl status grafana-server
grafana-cli plugins install frser-sqlite-datasource
systemctl enable grafana-server.service
reboot
```

`Copy code`
```
mkdir /home/ryu-schedule
cd /home/ryu-schedule/
###cp ryu-schedule to this dir
tar -zxvf ryu_schedule_v1.tar.gz
ls -al
drwxr-xr-x  2 root root    4096 Aug  9 01:35 mininet
drwxr-xr-x 16 root root    4096 Aug 13 10:12 ryu
```

`Other dependent packages`
```
pip install networkx
pip install schedule
```


## Use Guide
***Startup steps***
>Please make sure to start the program in the following order, some abnormalities may occur if the order is not followed

```shell
###Edit Setting
cd /home/ryu-schedule/ryu
~#cat app/setting.py
"""
        Common Setting
"""
Monitor_period = 20    # unit second, For monitoring flow traffic and link traffic interval, default 20,It is recommended to set more than 15 seconds
Link_Threshold = 100000000   # unit bit/s, Link rate threshold
Time_mode = "hours"
#hours: Refer to the previous hour rate
#days: Refer to the rate at the same time of the previous day
#weeks: Refer to the rate at the same time in the previous week


###Run Mininet
~#cd /home/ryu-schedule/mininet
~#python3 topo.py
.......
mininet>
###Run Ryu-App
~#cd /home/ryu-schedule/ryu
~#ryu-manager --observe-links app/gui_topology/gui_topology.py app/topo_feel.py app/get_link_speed.py app/get_path.py app/monitor_flow_stats.py app/schedule_traffic.py

###Run Mininet Init Script
~# bash mininet_init.sh

###Wait for 30 seconds, and then perform other operations after the APP initialization is over! ! !
```

**Topo View**
`Ryu Topo Info`：<http://127.0.0.1:8080/index.html> #yourserverip<=>127.0.0.1
![Topo](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/to1.jpg?raw=true)

***Mininet-Test***
```shell
mininet> pingall
*** Ping: testing ping reachability
h1 -> h2 h3 h4 h5 h6 h7 h8 h9 h10 h11 h12
h2 -> h1 h3 h4 h5 h6 h7 h8 h9 h10 h11 h12
h3 -> h1 h2 h4 h5 h6 h7 h8 h9 h10 h11 h12
h4 -> h1 h2 h3 h5 h6 h7 h8 h9 h10 h11 h12
h5 -> h1 h2 h3 h4 h6 h7 h8 h9 h10 h11 h12
h6 -> h1 h2 h3 h4 h5 h7 h8 h9 h10 h11 h12
h7 -> h1 h2 h3 h4 h5 h6 h8 h9 h10 h11 h12
h8 -> h1 h2 h3 h4 h5 h6 h7 h9 h10 h11 h12
h9 -> h1 h2 h3 h4 h5 h6 h7 h8 h10 h11 h12
h10 -> h1 h2 h3 h4 h5 h6 h7 h8 h9 h11 h12
h11 -> h1 h2 h3 h4 h5 h6 h7 h8 h9 h10 h12
h12 -> h1 h2 h3 h4 h5 h6 h7 h8 h9 h10 h11
*** Results: 0% dropped (132/132 received)
```

***Iperf generates traffic***
mininet_init.sh has started the iperf server for each host; only the iperf client needs to be started here
```shell
 ~# ip netns exec h1 iperf -c 10.0.0.8 -i 10 -b 60M -t 200
###means: h1 sends 60Mbps traffic to h8; lasts for 200 seconds
```

***Ryu Return Log***
```
The Ryu-Schedule log is very readable and will reflect the cycle CustomSpeed, SwitchLinkSpeed, new host access, link switching..
```
![Log-info](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/to4.jpg?raw=true)

***Sqlite3DB(Grafana)***
```
I didn’t do much research on Grafana, I just connected CustomSpeedDB and SwitchLinkSpeedDB to Grafana, and can draw the rate graph in real time
```
`Grafana Info`：<http://127.0.0.1:3000> #yourserverip<=>127.0.0.1

![Grafana-info](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/to5.jpg?raw=true)

***turn off an app***
>Please make sure to close the program in the following order
```shell
mininet>[Ctrl+D]
*** Stopping 1 controllers
...
*** Done

Ryu>[Ctrl+C]

iperf>killall iperf
```


## Sample Case
>In order to show the effect more perfect, please restart Ryu-App and Mininet and initialize the program after each case is over

### Case1 Topo Discovery and Log info
*This case will show how Ryu-Traffic-Schedule-System discovered Topo! *

***Steps***:
```shell
###Run Mininet
~#cd mininet/
~#python3 topo.py
.......
mininet>

###Run Ryu-App
~#cd ryu
~#ryu-manager --observe-links app/gui_topology/gui_topology.py app/topo_feel.py app/get_link_speed.py app/get_path.py app/monitor_flow_stats.py app/schedule_traffic.py

###Run Mininet Init Script
~# cd ryu
~# bash mininet_init.sh
```

***Topo Discovery***

Ryu Topo Info：<http://127.0.0.1:8080/index.html> #yourserverip<=>127.0.0.1

![topo-info2](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/t6.png?raw=true)

***Log feedback***
`custom_path_speed`:
```
src_ip: src host ip addr
dst_ip: dst host ip addr
speed(bps): src->dst host custom speed
path: currect forward path host5 to switch 3 to swtich 4 to switch 5 to host10
```
`switch_link_speed`:
```
datapath: local switch id
neighbor: neighbor switch id
port_id: local switch out port
tx_speed(bps): local switch->neighbor out port speed
rx_speed(bps): neighbor -> local local in port speed
```

```
####Log Info##
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path            
---------------- ---------------- ---------------- ----------------
        10.0.0.5        10.0.0.10         10499177        [3, 4, 5]
       10.0.0.10         10.0.0.5            10451        [5, 4, 3]
##############################################################################
##############################switch_link_speed###############################
datapath         neighbor         port_id  tx_speed(bps)    rx_speed(bps)
---------------- ---------------- -------- ---------------- ----------------
               4                5        4         10495323            10776
               4                6        5              311              311
               4                3        3            10776         10495299
               1                5        4              311              311
               1                6        5              311              311
               1                2        3              311              311
               6                2        4              311              335
               6                1        3              311              311
               6                5        6              311              311
               6                4        5              311              311
               5                1        3              311              311
               5                6        5              311              311
               5                4        4            10776         10495323
               5        10.0.0.10        2         10495290            10464
               3                2        3              311              335
               3                4        4         10495299            10776
               3         10.0.0.5        1            10776         10494945
               2                1        3              311              311
               2                6        5              335              311
               2                3        4              335              311
```

### Case2 Grafana configuration and display
*This case will guide users how to configure grafana and read customSpeedDB and SwitchLinkSpeedDB! *

***Steps***:
1. Install grafana (refer to install guide)
2. Configure grafana
  Warning: Before configuring grafana, make sure that Case1 has been running and the port_rate.db file has been generated in the ryu directory

   * 2.1 Associated DB
  ![link-db](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/db1.png?raw=true)
   * 2.2 SwitchLinkSpeedDB (data source creation)
  ![link-db](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/db3.png?raw=true)
   * 2.3 CustomLinkSpeedDB (data source creation)
  ![link-db](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/db2.png?raw=true)

3. Read the data
![link-db](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/db4.png?raw=true)


`Switch_Link_Speed`:![link-db](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/db5.png?raw=true)
Users can click on the corresponding Switch_Link to get the rate curve,
tx_speed 5_4: switch5->switch4 link speed

`CustomSpeed`:![link-db](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/db7.png?raw=true)
Users can click on the corresponding Custom Link to get the rate curve
speed {path="[5, 4, 3]", src_dst="10.0.0.10_10.0.0.5"}：
host10->host5 path=(h10 to switch5 to switch4 to switch3 to host5,speed is value)

### Case3 Shortest path forwarding
*This Case will show that Ryu-Traffic-Schedule-System provides the optimal path forwarding function for new services! (When the Link rate is lower than the threshold)*
***Steps***:
```shell
###Start the application, refer to Case1
###h1 complete communication with h3, h5, h7, h9, h11 respectively
###mininet> h1 ping h3
(Check the ryu log and choose the shortest path for us)
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
10.0.0.1         10.0.0.3              738           [1, 2]
10.0.0.3         10.0.0.1              738           [2, 1]
###mininet> h1 ping h5
(Check the ryu log and choose the shortest path for us)
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
10.0.0.1         10.0.0.5              268        [1, 2, 3]
10.0.0.5         10.0.0.1              268        [3, 2, 1]
###mininet> h1 ping h7
(Check the ryu log to select the shortest path for us; if there is a path with the same cost, choose the path with lower traffic)
(tx and rx may be forwarded through different paths, and the specific needs to be judged by the current link traffic size)
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
10.0.0.1         10.0.0.7              817        [1, 6, 4]
10.0.0.7         10.0.0.1              817        [4, 5, 1]
###mininet> h1 ping h9
(Check the ryu log and choose the shortest path for us)
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
10.0.0.1         10.0.0.9              800           [1, 5]
10.0.0.9         10.0.0.1              800           [5, 1]
###mininet> h1 ping h11
(Check the ryu log and choose the shortest path for us)
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
 10.0.0.1        10.0.0.11              761           [1, 6]
10.0.0.11         10.0.0.1              761           [6, 1]
```

### Case4 New user scheduling rules
*When a new user accesses, the system will first calculate the path with the lowest cost, whether the bandwidth exceeds 90% of the threshold, and if it exceeds 90% of the threshold, select another path*

***Requirement***: New services h5 and h10 need to communicate; the shortest path is [3,4,5], but link 3->4 already has 90M traffic;
***Expected result***: For new business h5->h10, choose the path with lower traffic [3, 2, 1, 5]

```shell
###Start the application, refer to Case1
###Simulate 90M traffic between 3->4
###mininet> h6 ping h7
~# ip netns exec h6 iperf -c 10.0.0.7 -i 10 -t 300 -b 90M
------------------------------------------------------------
Client connecting to 10.0.0.7, TCP port 5001
TCP window size: 85.3 KByte (default)
------------------------------------------------------------
[  3] local 10.0.0.6 port 39334 connected with 10.0.0.7 port 5001
[ ID] Interval       Transfer     Bandwidth
[  3]  0.0-10.0 sec   113 MBytes  94.5 Mbits/sec
###Ensure that Switch3<->4 has generated 90M traffic
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
        10.0.0.6         10.0.0.7         94653232           [3, 4]
        10.0.0.7         10.0.0.6           142769            [4, 3]
##############################################################################
##############################switch_link_speed###############################
datapath         neighbor         port_id  tx_speed(bps)    rx_speed(bps)
---------------- ---------------- -------- ---------------- ----------------
               5                6        5              378              354
               5                4        4              354              378
               5                1        3              406              354
               4                5        4              378              354
               4                6        5              354              354
               4                3        3           142966         94538195
               4         10.0.0.8        2              354                0
               4         10.0.0.7        1         94538108           142611
               6                4        5              354              354
               6                1        3              378              354
               6                2        4              354              354
               6                5        6              354              378
               3                4        4         94538195           142966
               3                2        3              354              354
               3         10.0.0.6        2           142966         94537680
               2                1        3              406              354
               2                3        4              354              354
               2                6        5              354              354
               1                2        3              354              406
               1                5        4              354              406
               1                6        5              354              378
```

`Read Grafana data`:
![data-90M](https://github.com/feng891005/Beautiful_github_contributions-/blob/main/images/data11.jpg?raw=true)

`Operation:` Simulate new business h5 ping h10

```shell
mininet> h5 ping h10
###Check ryu log; found that host5->host10 chose the lighter load [3,2,1,5] instead of the shortest path [3,4,5] with heavier load
New Host 10.0.0.5 Access to Switch 3
New Host 10.0.0.10 Access to Switch 5
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
10.0.0.6         10.0.0.7         94581773           [3, 4]
10.0.0.7         10.0.0.6           117450           [4, 3]
10.0.0.10         10.0.0.5              761        [5, 4, 3]
10.0.0.5        10.0.0.10              761        [3, 2, 1, 5]
```

### Case5 New User Scheduling Rules Plus

***Requirement***: New services h5 and h10 need to communicate; the shortest path is [3,4,5], but 90M traffic already exists for 3->4; 90M traffic already exists for 3->2;
***Expected result***: There is no available path from h5 to h10, and the system prompts the administrator to add a forwarding path

```
###Start the application, refer to Case1
###Simulate 90M traffic between 3->4
###mininet> h6 ping h7
~# ip netns exec h6 iperf -c 10.0.0.7 -i 10 -t 300 -b 90M
###mininet> h5 ping h3
~# ip netns exec h6 iperf -c 10.0.0.7 -i 10 -t 300 -b 90M

###Ensure that Switch3->4 and Switch3->2 have each generated 90M traffic
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
        10.0.0.5         10.0.0.3         94596352           [3, 2]
        10.0.0.3         10.0.0.5           101051           [2, 3]
        10.0.0.6         10.0.0.7         94595646           [3, 4]
        10.0.0.7         10.0.0.6           142620           [4, 3]
##############################################################################
##############################switch_link_speed###############################
datapath         neighbor         port_id  tx_speed(bps)    rx_speed(bps)
---------------- ---------------- -------- ---------------- ----------------
               3                2        3         94482307           101362
               3                4        4         94482285           142786
               3         10.0.0.5        1           101362         94481919
               3         10.0.0.6        2           142786         94481903
               2                3        4           101362         94482307
               2                1        3              311              311
               2                6        5              311              311
               2         10.0.0.3        1         94482341           101050
               6                5        6              311              311
               6                2        4              311              311
               6                4        5              311              311
               6                1        3              311              311
               1                6        5              311              311
               1                2        3              311              311
               1                5        4              311              311
               5                4        4              311              311
               5                1        3              311              311
               5                6        5              311              311
               4                6        5              311              311
               4                3        3           142786         94482285
               4                5        4              311              311
               4         10.0.0.7        1         94482574           142475
```
`Operation:` Simulate new business h5 ping h10

```shell
mininet> h5 ping h10
###Check the ryu log; it is found that host5->host10 did not select any path ([3, 2, 1, 5] or [3,4,5]), but prompted the administrator to add new physical bandwidth
New Host 10.0.0.10 Access to Switch 5
There is no excess bandwidth from 10.0.0.5 to 10.0.0.10 ,please add a new physical line.
There is no excess bandwidth from 10.0.0.6 to 10.0.0.10 ,please add a new physical line.
```

### Case6 The increase of old user traffic leads to excessive bandwidth of the physical link

*The increase in traffic of old users causes the Switch Link to exceed the bandwidth threshold, and some traffic is automatically scheduled to other links*

***Background***: h5->h1[30Mbps][Path:S3->S2->S1];h6->h4[40Mbps][Path:S3->S2];
***Requirement***: h5->h1 bandwidth increased from 30Mbps to 60Mbps;
***Expected result***: Since the total bandwidth of [Path:S3->S2] exceeds the threshold of 100Mbps, the system will schedule to move the lower bandwidth business h5->h1 to other paths;
```
###Start the application, refer to Case1
###Create a new business and use iper to simulate traffic
###h5->h1 30Mbps
~# ip netns exec h5 iperf -c 10.0.0.1 -i 10 -t 300 -b 30M
###h6->h4 40Mbps
~# ip netns exec h6 iperf -c 10.0.0.4 -i 10 -t 300 -b 40M
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
        10.0.0.5         10.0.0.1         31497298        [3, 2, 1]
        10.0.0.1         10.0.0.5            47525        [1, 2, 3]
        10.0.0.6         10.0.0.4         42048871           [3, 2]
        10.0.0.4         10.0.0.6            63424           [2, 3]
##############################################################################
##############################switch_link_speed###############################
datapath         neighbor         port_id  tx_speed(bps)    rx_speed(bps)
---------------- ---------------- -------- ---------------- ----------------
               1                5        4              311              311
               1                2        3            47832         31494611
               1                6        5              311              311
               1         10.0.0.1        1         31494583            47520
               6                5        6              311              311
               6                4        5              311              311
               6                2        4              311              311
               6                1        3              311              311
               4                3        3              311              311
               4                5        4              335              311
               4                6        5              311              311
               5                4        4              311              335
               5                1        3              311              311
               5                6        5              311              311
               3                2        3         73539387           111250
               3                4        4              311              311
               3         10.0.0.5        1            47832         31494243
               3         10.0.0.6        2            63753         42044776
               2                1        3         31494611            47832
               2                3        4           111250         73539387
               2                6        5              311              311
               2         10.0.0.4        2         42044706            63417
```
***Operation***: Increase the traffic of h5->h1 to 60Mbps, which can cause the bandwidth of [Path:S3->S2] to reach 100Mbps
```
~# ip netns exec h5 iperf -c 10.0.0.1 -i 10 -t 300 -b 60M
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
        10.0.0.5         10.0.0.1         63045894        [3, 2, 1]
        10.0.0.1         10.0.0.5            34918        [1, 2, 3]
        10.0.0.6         10.0.0.4         41995616           [3, 2]
        10.0.0.4         10.0.0.6            22662           [2, 3]
##############################################################################
##############################switch_link_speed###############################
datapath         neighbor         port_id  tx_speed(bps)    rx_speed(bps)
---------------- ---------------- -------- ---------------- ----------------
               2                3        4            58652        104980604
               2                1        3         62988418            35306
               2                6        5              339              335
               2         10.0.0.4        2         41992360            23346
               4                3        3              311              311
               4                5        4              311              311
               4                6        5              311              311
               3                2        3        104980604            58652
               3                4        4              311              311
               3         10.0.0.5        1            35334         62987844
               3         10.0.0.6        2            23658         41991898
               6                4        5              311              311
               6                5        6              335              311
               6                1        3              339              311
               6                2        4              335              339
               5                4        4              311              311
               5                1        3              339              311
               5                6        5              311              335
               1                5        4              311              339
               1                2        3            35306         62988418
               1                6        5              311              339
               1         10.0.0.1        1         62988250            34994
The Link of (3,2) current rate 104980604 exceeds the physical interface rate 100000000
Scdedule..,Divert some traffic to other physical links
Schedule Succeful: Move path ['00:00:00:00:11:06', 3, 4, 6, 2, '00:00:00:00:11:04'] to other link
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
        10.0.0.5         10.0.0.1         63671192        [3, 2, 1]
        10.0.0.1         10.0.0.5            34519        [1, 2, 3]
        10.0.0.4         10.0.0.6            37327           [2, 3]
    	
The Link of (3,2) current rate 104980604 exceeds the physical interface rate 100000000
Scdedule..,Divert some traffic to other physical links
Schedule Succeful: Move path ['00:00:00:00:11:05', 3, 4, 6, 1, '00:00:00:00:11:01'] to other link
```
***Result***: We found that the traffic from host6 to host4 was switched to [path3, 4, 6, 2], and the rates of all links were less than the threshold
```
##############################################################################
##############################switch_link_speed###############################
datapath         neighbor         port_id  tx_speed(bps)    rx_speed(bps)
---------------- ---------------- -------- ---------------- ----------------
               2                3        4            88054         48866525
               2                1        3         48236586            40756
               2                6        5              311         41424676
               2         10.0.0.4        2         42054503            47274
               4                3        3              311         56296117
               4                5        4              311              311
               4                6        5         56300621              339
               3                2        3         48866525            88054
               3                4        4         56296117              311
               3         10.0.0.5        1            40780         63109497
               3         10.0.0.6        2            47638         42051725
               6                4        5              339         56300621
               6                5        6              311              311
               6                1        3         14876069              339
               6                2        4         41424676              311
               5                4        4              311              311
               5                1        3              311              339
               5                6        5              311              311
               1                5        4              339              311
               1                2        3            40756         48236586
               1                6        5              339         14876069
               1         10.0.0.1        1         63112269            40444
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
        10.0.0.1         10.0.0.5            43499        [1, 2, 3]
        10.0.0.6         10.0.0.4         42045825     [3, 4, 6, 2]
        10.0.0.4         10.0.0.6            38126           [2, 3]
```

### Case7 The increase in the traffic of old users leads to the over-bandwidth of the physical link Plus
***Requirement***: All links exceed the threshold, no links are available, and the system prompts the administrator to add management links
***Background***: h5->h3[50Mbps]; h5->h7[70Mbps]; h6->h10[60Mbps];
***Expected result***: prompt the system administrator to increase the physical link
```

##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
        10.0.0.5         10.0.0.3         52541460           [3, 2]
        10.0.0.3         10.0.0.5            46552           [2, 3]
        10.0.0.5         10.0.0.7         73537066           [3, 4]
        10.0.0.7         10.0.0.5            79029           [4, 3]
        10.0.0.6        10.0.0.10         63039272     [3, 2, 6, 5]
       10.0.0.10         10.0.0.6            38124        [5, 4, 3]
##############################################################################
##############################switch_link_speed###############################
datapath         neighbor         port_id  tx_speed(bps)    rx_speed(bps)
---------------- ---------------- -------- ---------------- ----------------
               5                6        5              311         63047716
               5                4        4            49658              311
               5                1        3              311              311
               5        10.0.0.10        2         63047594            49346
               2                6        5         63046043              311
               2                3        4            59554        115540362
               2                1        3              311              311
               2         10.0.0.3        1         52494615            59242
               1                6        5              311              311
               1                2        3              311              311
               1                5        4              311              311
               4                6        5              311              311
               4                3        3           112737         73492500
               4                5        4              311            49658
               4         10.0.0.7        1         73492462            63079
               6                5        6         63047716              311
               6                4        5              311              311
               6                1        3              311              311
               6                2        4              311         63046043
               3                4        4         73492500           112737
               3                2        3        115540362            59554
               3         10.0.0.5        1           122632        125984644
               3         10.0.0.6        2            49656         63044787
The Link of (3,2) current rate 115540362 exceeds the physical interface rate 100000000
Scdedule..,Divert some traffic to other physical links
Schedule Fail: There are no more physical lines with sufficient bandwidth, please add a new physical line.
```

###Case8 Scheduling based on experience
***Requirement***: Dispatch based on experience value
***background:***
setting.py configure Time_mode = "days"
Yesterday at 17:00<->18:00 h5->h8, Paht3->4, the traffic 95 value is 60Mbps; today at 17:00, it will automatically schedule with reference to the experience at the same time the day before;

***Desired result***:
Today 17:00 h6->h10 bandwidth is 70Mbps, h5->h8 traffic is 10Mbps;
After scheduling and counting, it is judged that the business of h5->h8 in the next hour may increase to 60Mbps. After calculation, the public link Path S3->S4 will exceed the bandwidth threshold. Schedule in advance
```
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
        10.0.0.5         10.0.0.8         10551012           [3, 4]
        10.0.0.8         10.0.0.5             5981           [4, 3]
        10.0.0.6        10.0.0.10         73594190        [3, 4, 5]
       10.0.0.10         10.0.0.6            82492        [5, 4, 3]
##############################################################################
##############################switch_link_speed###############################
datapath         neighbor         port_id  tx_speed(bps)    rx_speed(bps)
---------------- ---------------- -------- ---------------- ----------------
               6                5        6              311              311
               6                2        4              311              335
               6                4        5              311              311
               6                1        3              311              311
               3                2        3              311              335
               3                4        4         84045164            88579
               3         10.0.0.5        1             6161         10499053
               3         10.0.0.6        2            82729         73545742
               2                3        4              335              311
               2                1        3              311              311
               2                6        5              335              311
               4                3        3            88579         84045164
               4                6        5              311              311
               4                5        4         73545382            82728
               4         10.0.0.8        2         10499280             5849
               5                4        4            82728         73545382
               5                1        3              311              311
               5                6        5              311              311
               5        10.0.0.10        2         73546171            82417
               1                5        4              311              311
               1                2        3              311              311
               1                6        5              311              311
Feature:The Link of (3,4) current rate 136606090 exceeds the physical interface rate 100000000
Feature:Scdedule..,Divert some traffic to other physical links
Schedule Succeful: Move path ['00:00:00:00:11:05', 3, 2, 6, 4, '00:00:00:00:11:08'] to other link

##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
        10.0.0.5         10.0.0.8         10551389     [3, 2, 6, 4]
        10.0.0.8         10.0.0.5             6166           [4, 3]
        10.0.0.6        10.0.0.10         73597796        [3, 4, 5]
       10.0.0.10         10.0.0.6           111027        [5, 4, 3]
##############################################################################
##############################switch_link_speed###############################
datapath         neighbor         port_id  tx_speed(bps)    rx_speed(bps)
---------------- ---------------- -------- ---------------- ----------------
               6                5        6              354              354
               6                2        4              354         10499391
               6                4        5         10499386              354
               6                1        3              354              354
               3                2        3         10499155              354
               3                4        4         73491813           117704
               3         10.0.0.5        1             6861         10498788
               3         10.0.0.6        2           111245         73491390
               2                3        4              354         10499155
               2                1        3              354              378
               2                6        5         10499391              354
               4                3        3           117704         73491813
               4                6        5              354         10499386
               4                5        4         73490951           111248
               4         10.0.0.8        2         10499019             6510
               5                4        4           111248         73490951
               5                1        3              354              354
               5                6        5              354              354
               5        10.0.0.10        2         73491687           110866
               1                5        4              354              354
               1                2        3              378              354
               1                6        5              354              354
```
```Operation```: Continue to increase the traffic of h5->h8 from 10Mbps to 60Mbps, the traffic will not exceed the link threshold and will not be rescheduled
```
root@Ubuntu18:/home/centec# ip netns exec h5 iperf -c 10.0.0.8 -i 10 -t 3000 -b 60M
##############################################################################
#############################custom_path_speed################################
src_ip           dst_ip           speed(bps)       path
---------------- ---------------- ---------------- ----------------
        10.0.0.5         10.0.0.8         63046413     [3, 2, 6, 4]
        10.0.0.8         10.0.0.5            36387           [4, 3]
        10.0.0.6        10.0.0.10         73545339        [3, 4, 5]
       10.0.0.10         10.0.0.6           110921        [5, 4, 3]
##############################################################################
##############################switch_link_speed###############################
datapath         neighbor         port_id  tx_speed(bps)    rx_speed(bps)
---------------- ---------------- -------- ---------------- ----------------
               6                5        6              311              311
               6                2        4              311         63046743
               6                4        5         63046624              311
               6                1        3              311              335
               3                2        3         63045206              311
               3                4        4         73543892           147326
               3         10.0.0.5        1            36407         63044826
               3         10.0.0.6        2           111231         73543518
               2                3        4              311         63045206
               2                1        3              311              335
               2                6        5         63046743              311
               4                3        3           147326         73543892
               4                6        5              311         63046624
               4                5        4         73543058           111229
               4         10.0.0.8        2         63044418            36095
               5                4        4           111229         73543058
               5                1        3              311              335
               5                6        5              311              311
               5        10.0.0.10        2         73543743           110918
               1                5        4              335              311
               1                2        3              335              311
               1                6        5              335              311
```
